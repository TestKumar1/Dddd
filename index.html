<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smartlink Funnel — Single File</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#0ea5ff;--muted:#9aa7b2;--ok:#10b981;}
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;}
  body{margin:0;background:linear-gradient(180deg,#071426 0%, #071a2d 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:24px;}
  .wrap{width:980px;max-width:98%;margin:18px auto 80px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  header h1{font-size:20px;margin:0;color:var(--accent)}
  nav a{color:var(--muted);text-decoration:none;margin-left:12px;font-size:14px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:20px;border-radius:10px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
  .page-title{font-size:22px;margin:0 0 8px;color:#fff}
  .content{color:var(--muted);line-height:1.6}
  .cta{display:inline-block;margin:18px 0;padding:14px 20px;background:var(--accent);color:#052033;border-radius:8px;font-weight:700;text-decoration:none}
  .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#0b1720;color:var(--muted);border:1px solid rgba(255,255,255,0.03);cursor:pointer;margin-right:8px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:16px;color:var(--muted);font-size:13px}
  .columns{display:flex;gap:12px;margin-top:12px}
  .col{flex:1}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e8f1f7}
  textarea{min-height:110px;resize:vertical}
  .admin-note{font-size:13px;background:rgba(14,165,255,0.06);padding:8px;border-radius:6px;color:var(--muted);margin-bottom:10px}
  .top-stats{display:flex;gap:12px;margin-top:12px}
  .stat{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);flex:1;text-align:center}
  .danger{background:rgba(255,50,50,0.06);color:#ffb3b3;border:1px solid rgba(255,50,50,0.08)}
  .success{background:rgba(16,185,129,0.06);color:var(--ok);border:1px solid rgba(16,185,129,0.08)}
  .hidden{display:none}
  .note{font-size:13px;color:var(--muted);margin-top:8px}
  pre{white-space:pre-wrap;background:rgba(255,255,255,0.02);padding:10px;border-radius:6px;color:var(--muted);font-size:13px;}
  .link-row{display:flex;gap:8px;flex-wrap:wrap}
  .small-muted{font-size:12px;color:var(--muted)}
  @media (max-width:820px){.columns{flex-direction:column}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>SmartFunnel — Single File</h1>
      <nav>
        <a href="#home" id="nav-home">Home</a>
        <a href="#page1" id="nav-p1">Page 1</a>
        <a href="#page2" id="nav-p2">Page 2</a>
        <a href="#page3" id="nav-p3">Page 3</a>
        <a href="#admin" id="nav-admin">Admin</a>
      </nav>
    </header>

    <div id="main" class="card">
      <!-- content injected here -->
    </div>

    <footer class="small note">
      Tip: Save your admin password somewhere safe. This is a client-side admin (localStorage). For public hosting use domain + HTTPS.
    </footer>
  </div>

<script>
/*
  Single-file Smartlink funnel
  - Pages: home, page1, page2, page3
  - Admin: edit page title, html content, smartlinks list (comma separated), rotation toggle
  - Data stored in localStorage under key: smartf_data_v1
  - Click counts & rotation pointers stored per page
*/

const STORAGE_KEY = 'smartf_data_v1';
const CLICK_KEY = 'smartf_clicks_v1';
const ROT_KEY = 'smartf_rot_v1';
const ADMIN_PW_KEY = 'smartf_admin_pw_v1';

// default content
const DEFAULT_DATA = {
  siteTitle: "SmartFunnel Demo",
  home: {
    title: "Welcome — Start Here",
    content: "<p>Ye site aapke YouTube viewers ko funnel karne ke liye bana hai. Click 'Start' to begin the 3-step process.</p>",
    links: ["https://example.com/"],   // home usually internal
    rotate: false
  },
  page1: {
    title: "Step 1 — Financial Check",
    content: "<p>Step 1: Quick financial check. Click continue to proceed.</p>",
    links: ["https://adsterra.example/smartlink"], // replace with your Adsterra smartlink(s)
    rotate: false
  },
  page2: {
    title: "Step 2 — Verification",
    content: "<p>Step 2: Verification step. Please continue for the report.</p>",
    links: ["https://propeller.example/smartlink"], // replace with your Propeller smartlink(s)
    rotate: false
  },
  page3: {
    title: "Step 3 — Final Result",
    content: "<p>Step 3: Final result & resources. Click to open final offer.</p>",
    links: ["https://monetag.example/smartlink"], // replace with your Monetag smartlink(s)
    rotate: false
  },
  // basic settings
  settings: {
    adminPassword: "1234", // CHANGE this ASAP from Admin screen
    rotationGlobal: false
  }
};

// helpers for storage
function loadData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_DATA)); return JSON.parse(JSON.stringify(DEFAULT_DATA)); }
    return JSON.parse(raw);
  }catch(e){
    console.error('loadData err',e);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_DATA));
    return JSON.parse(JSON.stringify(DEFAULT_DATA));
  }
}
function saveData(d){ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }
function loadClicks(){ try{ return JSON.parse(localStorage.getItem(CLICK_KEY) || '{}');}catch(e){return {};}}
function saveClicks(o){ localStorage.setItem(CLICK_KEY, JSON.stringify(o)); }
function loadRot(){ try{ return JSON.parse(localStorage.getItem(ROT_KEY) || '{}');}catch(e){return {};}}
function saveRot(o){ localStorage.setItem(ROT_KEY, JSON.stringify(o)); }
function getAdminPassword(){ const d = loadData(); return d.settings?.adminPassword || DEFAULT_DATA.settings.adminPassword; }

// router
function route(){
  const hash = (location.hash || '#home').replace('#','');
  if(['home','page1','page2','page3','admin'].indexOf(hash)===-1) location.hash = '#home';
  render(hash || 'home');
}
window.addEventListener('hashchange', route);
window.addEventListener('load', route);

// render
function render(page){
  const data = loadData();
  const main = document.getElementById('main');
  // update nav active (simple)
  ['nav-home','nav-p1','nav-p2','nav-p3','nav-admin'].forEach(id=>document.getElementById(id).style.opacity=1);
  // basic content rendering
  if(page==='home'){
    main.innerHTML = `
      <h2 class="page-title">${escapeHtml(data.home.title)}</h2>
      <div class="content">${data.home.content}</div>
      <div style="margin-top:14px">
        <a class="cta" href="#page1">Start →</a>
        <button class="btn" onclick="openAdminLogin()">Admin</button>
      </div>
      <div class="top-stats">
        <div class="stat"><strong>Clicks</strong><div class="small-muted" id="stat-clicks-home">0</div></div>
        <div class="stat"><strong>Stored Pages</strong><div class="small-muted">Home, Page1, Page2, Page3</div></div>
      </div>
    `;
    updateStats('home');
    return;
  }

  if(page==='page1' || page==='page2' || page==='page3'){
    const p = data[page];
    const next = page==='page1'?'#page2':page==='page2'?'#page3':'#home';
    main.innerHTML = `
      <h2 class="page-title">${escapeHtml(p.title)}</h2>
      <div class="content">${p.content}</div>
      <div style="margin-top:18px" class="link-row">
        <button class="cta" id="cta-main">Open Offer →</button>
        <a class="btn" href="${next}">Next Page</a>
        <a class="btn" href="#admin">Admin</a>
      </div>
      <div class="note">Smartlinks: <span class="small-muted" id="links-list">${p.links.join(' , ')}</span></div>
    `;
    // wire cta
    document.getElementById('cta-main').addEventListener('click', ()=>handleClick(page));
    updateStats(page);
    return;
  }

  if(page==='admin'){
    // check password prompt: simple client-side
    const pw = getAdminPassword();
    main.innerHTML = `
      <h2 class="page-title">Admin Panel</h2>
      <div class="admin-note">
        This is a client-side admin. Data saved in your browser (localStorage). Do NOT use this as secure server admin. Change the admin password immediately.
      </div>
      <div class="columns">
        <div class="col card" style="padding:12px">
          <h3 style="margin-top:0">Login</h3>
          <div class="small-muted">Enter admin password to edit pages.</div>
          <div style="margin-top:8px">
            <input type="password" id="admin-pass-input" placeholder="Admin password" />
            <div style="margin-top:8px">
              <button class="btn" id="admin-login-btn">Login</button>
              <button class="btn" id="admin-reset-btn">Reset Data</button>
            </div>
          </div>
          <div id="admin-login-msg" class="note"></div>
        </div>

        <div class="col card" style="padding:12px">
          <h3 style="margin-top:0">Quick Tools</h3>
          <div class="small-muted">Export / Import your content (backup)</div>
          <div style="margin-top:8px">
            <button class="btn" id="export-btn">Export JSON</button>
            <button class="btn" id="import-btn">Import JSON</button>
            <input type="file" id="import-file" class="hidden" accept=".json" />
          </div>
          <div style="margin-top:10px">
            <button class="btn danger" id="clear-clicks">Clear Click Stats</button>
            <button class="btn" id="reset-defaults">Reset to Defaults</button>
          </div>
          <div class="note" style="margin-top:10px">Admin password (current): <code id="show-pw" class="small-muted">********</code></div>
        </div>
      </div>

      <div id="admin-editor" class="hidden" style="margin-top:12px">
        <div class="columns">
          <div class="col card">
            <h3 style="margin-top:0">Edit Page</h3>
            <label>Choose Page</label>
            <select id="select-page">
              <option value="home">Home</option>
              <option value="page1">Page 1</option>
              <option value="page2">Page 2</option>
              <option value="page3">Page 3</option>
            </select>
            <label style="margin-top:8px">Title</label>
            <input id="edit-title" type="text" />
            <label style="margin-top:8px">HTML Content (use &lt;p&gt; &lt;br&gt; etc.)</label>
            <textarea id="edit-content"></textarea>
            <label style="margin-top:8px">Smartlinks (comma separated)</label>
            <input id="edit-links" type="text" placeholder="https://one,https://two" />
            <label style="margin-top:8px">Rotate Links for this page?</label>
            <select id="edit-rotate"><option value="false">No</option><option value="true">Yes</option></select>
            <div style="margin-top:10px">
              <button class="btn" id="save-page-btn">Save Page</button>
              <button class="btn" id="delete-page-btn">Delete Page (restore default)</button>
            </div>
          </div>

          <div class="col card">
            <h3 style="margin-top:0">Site Settings</h3>
            <label>Site Title</label>
            <input id="site-title" type="text" />
            <label style="margin-top:8px">Admin Password (change)</label>
            <input id="site-pw" type="password" />
            <label style="margin-top:8px">Global Rotation (when enabled, each page rotates list on clicks)</label>
            <select id="global-rot"><option value="false">No</option><option value="true">Yes</option></select>
            <div style="margin-top:10px">
              <button class="btn" id="save-settings">Save Settings</button>
            </div>

            <div style="margin-top:14px">
              <h4 style="margin:6px 0">Click Stats</h4>
              <pre id="click-stats-pre"></pre>
            </div>
          </div>
        </div>
      </div>
    `;
    // wire buttons
    document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
    document.getElementById('admin-reset-btn').addEventListener('click', ()=>{ if(confirm('Reset ALL stored data to defaults?')) { localStorage.removeItem(STORAGE_KEY); localStorage.removeItem(CLICK_KEY); localStorage.removeItem(ROT_KEY); location.reload(); }});
    document.getElementById('export-btn').addEventListener('click', exportJSON);
    document.getElementById('import-btn').addEventListener('click', ()=>document.getElementById('import-file').click());
    document.getElementById('import-file').addEventListener('change', importJSON);
    document.getElementById('clear-clicks').addEventListener('click', ()=>{ if(confirm('Clear click stats?')){ localStorage.removeItem(CLICK_KEY); alert('Cleared'); }});
    document.getElementById('reset-defaults').addEventListener('click', ()=>{ if(confirm('Reset site data to DEFAULTS?')){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_DATA)); alert('Defaults restored'); location.reload(); }});
    document.getElementById('show-pw').textContent = getAdminPassword().replace(/./g,'*');
  }
}

// admin login and editor
function adminLogin(){
  const input = document.getElementById('admin-pass-input').value || '';
  const pw = getAdminPassword();
  const msg = document.getElementById('admin-login-msg');
  if(input === pw){
    msg.textContent = 'Login success. Editor unlocked.';
    document.getElementById('admin-editor').classList.remove('hidden');
    populateEditor();
  } else {
    msg.textContent = 'Wrong password.';
  }
}
function openAdminLogin(){ location.hash='#admin'; setTimeout(()=>document.getElementById('admin-pass-input')?.focus(),200); }

// editor populate
function populateEditor(){
  const data = loadData();
  document.getElementById('site-title').value = data.siteTitle || '';
  document.getElementById('site-pw').value = data.settings.adminPassword || '';
  document.getElementById('global-rot').value = data.settings.rotationGlobal? 'true':'false';
  const select = document.getElementById('select-page');
  select.addEventListener('change', ()=>loadPageToEditor(select.value));
  loadPageToEditor(select.value);

  document.getElementById('save-page-btn').addEventListener('click', savePageFromEditor);
  document.getElementById('delete-page-btn').addEventListener('click', ()=>{
    const p = select.value;
    if(confirm('Restore this page to default?')){ const d = loadData(); d[p] = DEFAULT_DATA[p]; saveData(d); alert('Restored'); loadPageToEditor(p);}
  });
  document.getElementById('save-settings').addEventListener('click', ()=>{
    const d = loadData();
    d.siteTitle = document.getElementById('site-title').value || d.siteTitle;
    const newpw = document.getElementById('site-pw').value;
    if(newpw && newpw.length>=3) d.settings.adminPassword = newpw;
    d.settings.rotationGlobal = document.getElementById('global-rot').value === 'true';
    saveData(d);
    alert('Settings saved. Change reflected immediately.');
    document.getElementById('show-pw').textContent = getAdminPassword().replace(/./g,'*');
  });

  // show click stats
  refreshClickStats();
}

// load selected page into editor fields
function loadPageToEditor(key){
  const d = loadData();
  const page = d[key];
  document.getElementById('edit-title').value = page.title || '';
  document.getElementById('edit-content').value = page.content || '';
  document.getElementById('edit-links').value = (page.links || []).join(',');
  document.getElementById('edit-rotate').value = page.rotate? 'true':'false';
}
function savePageFromEditor(){
  const sel = document.getElementById('select-page').value;
  const d = loadData();
  d[sel].title = document.getElementById('edit-title').value || d[sel].title;
  d[sel].content = document.getElementById('edit-content').value || d[sel].content;
  const rawlinks = document.getElementById('edit-links').value.trim();
  d[sel].links = rawlinks? rawlinks.split(',').map(s=>s.trim()).filter(Boolean): [];
  d[sel].rotate = document.getElementById('edit-rotate').value === 'true';
  saveData(d);
  alert('Page saved.');
  refreshClickStats();
}

// export/import
function exportJSON(){
  const data = JSON.stringify(loadData(), null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'smartf_backup.json'; document.body.appendChild(a); a.click(); a.remove();
}
function importJSON(e){
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const parsed = JSON.parse(r.result);
      if(confirm('Import will overwrite current data. Continue?')){ localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed)); alert('Imported. Reloading.'); location.reload(); }
    }catch(err){ alert('Invalid JSON.'); }
  };
  r.readAsText(f);
}

// click handler: open smartlink(s) with rotation logic
function handleClick(pageKey){
  const d = loadData();
  const page = d[pageKey];
  if(!page || !(page.links && page.links.length)) { alert('No smartlink defined for this page. Please set in Admin.'); return; }

  // rotation logic: per-page pointer
  let rot = loadRot();
  if(!rot[pageKey]) rot[pageKey] = 0;
  const globalRot = d.settings.rotationGlobal;
  const pageUseRotate = page.rotate || false;

  // compute index
  let idx = 0;
  if(globalRot || pageUseRotate){
    idx = rot[pageKey] % page.links.length;
    rot[pageKey] = (rot[pageKey] + 1) % page.links.length;
    saveRot(rot);
  }

  const target = page.links[idx] || page.links[0];
  // track click count
  const clicks = loadClicks();
  clicks[pageKey] = (clicks[pageKey]||0) + 1;
  saveClicks(clicks);
  refreshClickStats();

  // open in new tab
  window.open(target, '_blank');
}

// stats refresh
function refreshClickStats(){
  const clicks = loadClicks();
  const pre = document.getElementById('click-stats-pre');
  if(pre) pre.textContent = JSON.stringify(clicks, null, 2);
}
function updateStats(page){
  const clicks = loadClicks();
  const el = document.getElementById('stat-clicks-'+page);
  if(el) el.textContent = (clicks[page]||0) + ' clicks';
  // also update small list
  const linksList = document.getElementById('links-list');
  if(linksList) {
    const d = loadData();
    const p = d[page];
    linksList.textContent = p ? (p.links||[]).join(' , ') : '';
  }
}

// small util
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

</script>
</body>
</html>
